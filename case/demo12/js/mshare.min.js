/*! mshare 2015-11-12 */
!function(a,b,c){function d(a,c){"undefined"==typeof b.brickjs&&(b.brickjs={}),brickjs[a]=c}function e(d,e){this._cfgs={site:"",catalog:"",sUrl:b.location.href,title:c.title,imgUrl:"",desc:"",appKey:"",ralateUid:"",timelineCallback:function(){},sendMessageCallback:function(){},shareQQCallback:function(){},wxGuide:{tpl:"",imgUrl:"http://css.selfimg.com.cn/cnt/mobile/images/weixin-share.png",width:295,height:273,style:{right:0,top:0}}},this.weixinSigned=0,this.trigger=a(e),this._baseUrl="http://application.self.com.cn/share/front/",this._tsinaParam="collect?platform=tsina&title={title}&url={url}&pic={pic}&site={site}&cat={cat}&ralateUid={ralateUid}&appkey={appkey}",this._init(d,e),this._reflux()}var f=navigator.userAgent.toLowerCase().indexOf("micromessenger")>-1;e.prototype={_init:function(b,c){var d=this;a.extend(!0,this._cfgs,b),c&&a(c).on("click",function(){f?d._weixinGuide():d._weiboShare(a(this))}),f&&this.weixinInit()},_weixinGuide:function(){var b=this._cfgs,c=b.wxGuide,d=c.imgUrl,e=c.tpl||'<div id="weixin_guide" style="position: fixed;background:url(http://css.selfimg.com.cn/cnt/mobile/images/blk80.png) repeat;left:0;top:0;right:0;bottom:0;z-index:1000;"><img src="'+d+'" style="position: absolute;z-index:100;" width="'+c.width+'" height="'+c.height+'"/></div>';a("#weixin_guide").remove(),a(e).attr("id","weixin_guide").appendTo(a("body")),a("#weixin_guide img").css(c.style||{}),setTimeout(function(){a("#weixin_guide").click(function(){a(this).remove()})},300)},weixinInit:function(b){var d,e=this;b&&a.extend(!0,this._cfgs,b),d={site:this._cfgs.website||["vogue","self","gq","adstyle","cnt","subscribe"][this._cfgs.site-1],img_url:this._cfgs.imgUrl||"",link:this._cfgs.sUrl||location.href,desc:this._cfgs.desc||"",title:this._cfgs.title||c.title,timelineCallback:this._cfgs.timelineCallback,sendMessageCallback:this._cfgs.sendMessageCallback,shareQQCallback:this._cfgs.shareQQCallback};var f="subscribe"!==d.site?"http://application.gq.com.cn/mazephp/project/weixin/?Sign.getSign":"http://application.cntraveler.com.cn/weixin/api/getSign.php";a.getJSON(f+"?site="+d.site+"&url="+encodeURIComponent(location.href)+"&callback=?",function(a){a.status&&(wx.config({appId:a.appId,timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareAppMessage({title:d.title,desc:d.desc,link:d.link,imgUrl:d.img_url,success:function(a){d.sendMessageCallback("success",a),e._shareLog(0,1)},cancel:function(a){d.sendMessageCallback("cancel",a),e._shareLog(0,2)},fail:function(a){d.sendMessageCallback("fail",a),e._shareLog(0,0)}}),wx.onMenuShareTimeline({title:d.title,link:d.link,imgUrl:d.img_url,success:function(a){d.timelineCallback("success",a),e._shareLog(1,1)},cancel:function(a){d.timelineCallback("cancel",a),e._shareLog(1,2)},fail:function(a){d.timelineCallback("fail",a),e._shareLog(1,0)}}),wx.onMenuShareQQ({title:d.title,link:d.link,imgUrl:d.img_url,success:function(a){d.shareQQCallback("success",a),e._shareLog(2,1)},cancel:function(a){d.shareQQCallback("cancel",a),e._shareLog(2,2)},fail:function(a){d.shareQQCallback("fail",a),e._shareLog(2,0)}})}))})},reset:function(a){var b=this;f?this.weixinInit({sUrl:a.sUrl||b._cfgs.sUrl,desc:a.desc||b._cfgs.desc,imgUrl:a.imgUrl||b._cfgs.imgUrl,title:a.title||b._cfgs.title}):(a.sUrl&&b.trigger.data("sUrl",a.sUrl),a.desc&&b.trigger.data("desc",a.desc),a.imgUrl&&b.trigger.data("imgUrl",a.imgUrl))},_reflux:function(){var b=(c.referrer,c.location.href),d=location.search.substr(1),e=navigator.userAgent;(d.indexOf("tsina-")>-1||d.indexOf("timeline")>-1||d.indexOf("singlemessage")>-1||d.indexOf("groupmessage")>-1)&&a.getJSON(this._baseUrl+"reflux?callback=?&url="+encodeURIComponent(b)+"&ua="+e+"&param="+encodeURIComponent(d))},_shareLog:function(b,c){var d=this._cfgs.website||["vogue","self","gq","adstyle","cnt","subscribe"][this._cfgs.site-1];a.get(this._baseUrl+"collectmobile?platform=weixin&site="+d+"&url="+encodeURIComponent(location.href)+"&title="+encodeURIComponent(this._cfgs.title)+"&pic="+encodeURIComponent(this._cfgs.imgUrl)+"&ac="+b+"&sc="+c+"&ua="+encodeURIComponent(navigator.userAgent))},_weiboShare:function(a){var c=this,d=this._cfgs,e={title:d.desc,url:d.sUrl,pic:d.imgUrl,site:d.site,cat:d.catalog,ralateUid:d.ralateUid,appkey:d.appKey.tsina},f=a.data("sUrl"),g=a.data("desc"),h=a.data("imgUrl");e.title=encodeURIComponent(g?g:e.title),e.url=encodeURIComponent(f?f:e.url),e.pic=encodeURIComponent(h?h:e.pic);var i=this._baseUrl+c._formatUri(this._tsinaParam,e);b.open(i)},_formatUri:function(a,b){var c,a=a;for(var d in b)c=new RegExp("{"+d+"}","g"),a=a.replace(c,b[d]);return a}},d("MShare",e)}("undefined"!=typeof Zepto?Zepto:jQuery,window,document);